<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini-Max Generator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .container {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      textarea {
        width: 100%;
        height: 100px;
        padding: 10px;
      }
      button {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:disabled {
        background-color: #cccccc;
      }
      #result {
        white-space: pre-wrap;
        padding: 20px;
        background-color: #f5f5f5;
        border-radius: 5px;
        display: none;
      }
      .loading {
        display: none;
        color: #666;
      }
      #error {
        color: red;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Mini-Max Generator</h1>

      <div>
        <label for="prompt">Enter your prompt:</label>
        <textarea
          id="prompt"
          placeholder="Create a fun ringtone about..."
        ></textarea>
      </div>

      <button onclick="generateMiniMax()" id="generateBtn">Generate</button>
      <button onclick="testServerConnection()" id="testBtn">
        Test Server Connection
      </button>

      <div id="loading" class="loading">Generating... Please wait...</div>
      <div id="error"></div>
      <div id="serverResponse" style="margin-top: 10px; color: blue"></div>

      <div id="result">
        <h3>Generated Lyrics:</h3>
        <div id="lyrics"></div>

        <h3>Audio Player:</h3>
        <audio id="audioPlayer" controls></audio>
      </div>
    </div>

    <script>
      async function generateMiniMax() {
        const prompt = document.getElementById("prompt").value;
        const generateBtn = document.getElementById("generateBtn");
        const loading = document.getElementById("loading");
        const error = document.getElementById("error");
        const result = document.getElementById("result");

        if (!prompt) {
          alert("Please enter a prompt");
          return;
        }

        // Reset UI
        error.style.display = "none";
        result.style.display = "none";
        loading.style.display = "block";
        generateBtn.disabled = true;

        try {
          const response = await fetch(
            "https://ringtone.fanquish.com/generate-mini-maxi",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-API-Key": "3a7c4f8b2e1d9a0b5c6f3e2d1a8b7c4f",
              },
              body: JSON.stringify({ prompt }),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (data.message) {
            // Display lyrics
            document.getElementById("lyrics").textContent =
              data.lyrics || "Lyrics not available";

            // Set up audio player with file path
            const audioPlayer = document.getElementById("audioPlayer");
            audioPlayer.src = data.filePath;
            audioPlayer.load();

            // Show results
            result.style.display = "block";
          } else {
            throw new Error(data.error || "Generation failed");
          }
        } catch (err) {
          error.textContent = "Error: " + err.message;
          error.style.display = "block";
        } finally {
          loading.style.display = "none";
          generateBtn.disabled = false;
        }
      }

      async function testServerConnection() {
        const testBtn = document.getElementById("testBtn");
        const serverResponse = document.getElementById("serverResponse");

        testBtn.disabled = true;
        serverResponse.textContent = "Testing connection...";

        try {
          const response = await fetch("https://ringtone.fanquish.com/", {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.text();
          serverResponse.textContent = `Server Response: ${data}`;
          console.log("Server test response:", data);
        } catch (err) {
          serverResponse.textContent = `Connection Error: ${err.message}`;
          console.error("Server test error:", err);
        } finally {
          testBtn.disabled = false;
        }
      }

      // Allow Enter key in textarea to submit
      document
        .getElementById("prompt")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            generateMiniMax();
          }
        });
    </script>
  </body>
</html>
